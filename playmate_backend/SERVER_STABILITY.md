# 서버 안정성 가이드

## 🚀 안정적인 서버 실행 방법

### 1. 일반 개발 (권장)
```bash
npm run dev:stable
```
- 자동 재시작 기능
- 포트 고정 (3000)
- 에러 로그 저장
- 연결 실패 시 자동 복구

### 2. 서버 상태 확인
```bash
npm run status
```

### 3. 서버 재시작
```bash
npm run restart
```

### 4. 서버 종료
```bash
npm run kill
```

## 🔧 문제 해결

### 포트 충돌 문제
```bash
# 포트 사용 중인 프로세스 확인
lsof -i :3000

# 강제 종료
npm run kill
```

### 환경변수 충돌 문제
```bash
# 현재 PORT 환경변수 확인
echo $PORT

# 환경변수 초기화
unset PORT
```

### 로그 확인
```bash
# 서버 로그
tail -f logs/server.log

# 에러 로그
tail -f logs/error.log
```

## 📊 안정성 기능

### ✅ 구현된 기능
- [x] 포트 고정 (3000)
- [x] 자동 재시작
- [x] 환경변수 충돌 방지
- [x] 에러 로그 저장
- [x] 연결 상태 모니터링
- [x] JWT 토큰 영구화
- [x] 다중 URL 백업 (Flutter)

### 🔄 자동 복구 시나리오
1. **서버 크래시**: 5초 후 자동 재시작
2. **포트 충돌**: 기존 프로세스 종료 후 재시작
3. **네트워크 오류**: Flutter에서 백업 URL 시도
4. **메모리 오버플로우**: 1GB 초과 시 재시작

## 🎯 프로덕션 배포

### PM2 사용 (선택사항)
```bash
# PM2 설치
npm install -g pm2

# PM2로 시작
pm2 start ecosystem.config.js

# PM2 상태 확인
pm2 status

# PM2 로그
pm2 logs
```

## 📱 Flutter 앱 연결

### 안정적인 연결 설정
- **Android 에뮬레이터**: `http://10.0.2.2:3000/api`
- **iOS 시뮬레이터**: `http://localhost:3000/api`
- **네트워크**: `http://192.168.6.100:3000/api`

### 연결 실패 시 자동 백업
1. 기본 URL 3회 재시도
2. 백업 URL들 순차 시도
3. 연결 성공 시 해당 URL 사용

## ⚡ 성능 최적화

### 메모리 관리
- 최대 메모리: 1GB
- 자동 재시작: 메모리 초과 시
- 로그 파일 자동 로테이션

### 연결 최적화
- 타임아웃: 30초
- 재시도: 3회
- 백업 URL: 3개

---

**이제 서버가 안정적으로 실행됩니다!** 🎉
